"use strict()";var jotterDirectives=angular.module("jotterDirectives",[]),jotterServices=angular.module("jotterServices",["ngResource"]),jotterApp=angular.module("jotterApp",["jotterDirectives","jotterServices","jotterTemplates","ngAnimate","ngRoute","ngTouch","ui.select2"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"static/views/main.html",controller:"MainCtrl"}).when("/lists/:id",{templateUrl:"static/views/checkList.html",controller:"CheckListCtrl"}).when("/login",{templateUrl:"static/views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken"}]);angular.module("jotterTemplates",["templates/alert.html","templates/header.html"]),angular.module("templates/alert.html",[]).run(["$templateCache",function(e){e.put("templates/alert.html",'<div class="container"><div class="row" id="alert"><div class="alert fade in {{ alertStatus }} col-md-10 col-md-offset-1 col-lg-6 col-lg-offset-3" ng-show="visible"><button class="close" type="button" aria-hidden="true" ng-click="dismiss()">&times;</button><strong>{{ title }}</strong>&nbsp;{{ message }}</div></div></div>')}]),angular.module("templates/header.html",[]).run(["$templateCache",function(e){e.put("templates/header.html",'<div><h1><a href="/">Jotter</a></h1><jtr-alert></jtr-alert></div>')}]),jotterApp.controller("CheckListCtrl",["$location","$routeParams","$scope","CheckList","CheckListItem","Session","User",function(e,t,i,s,c,n,r){i.checkListItemEdit={},n.getUser({onSuccess:function(e){i.user=e}}),r.query(function(e){i.users=_.reject(e,function(e){return"!"===e.username})});var o=t.id;(angular.isUndefined(o)||""===o)&&(i.$root.$broadcast("alert",{title:"I can't find that list"}),e.$path("/#/lists")),i.$on("checkList:refresh",function(){i.checkList=s.get({id:o})}),i.checkList=s.get({id:o});var a=function(){var e=new c({check_list:i.checkList.id,checked:!0,description:i.checkListItemEdit.description,title:i.checkListItemEdit.title}),t=function(){i.checkList.check_list_items.push(e),i.checkListItemEdit.description="",i.checkListItemEdit.title=""},s=function(){i.$root.$broadcast("alert",{message:"and we can't save "+i.checkListItemEdit.title+" right now",status:"danger",title:"Something's wrong"})};e.$save(t,s)};i.saveCheckListItem=function(){if(angular.isDefined(i.checkListItemEdit.id)){var e=new c(i.checkListItemEdit);e.$update()}else a()},i.toggleCheckListItemChecked=function(e){e.checked=!e.checked,e=new c(e),e.$update()}}]),jotterApp.controller("LoginCtrl",["$location","$scope","Session",function(e,t,i){t.password="",t.username="",i.getUser({onSuccess:function(t){t.isAuthenticated&&e.path("/#/")}}),t.login=function(){i.create({password:t.password,username:t.username},function(){t.$root.$broadcast("alert",{status:"success",title:"Welcome Back!"}),e.path("/#/")},function(e){t.$root.$broadcast("alert",{status:"danger",title:"Try Again",message:e.data.detail})})}}]),jotterApp.controller("MainCtrl",["$location","$scope","CheckList","Session",function(e,t,i,s){s.getUser({onSuccess:function(e){t.user=e}}),t.checkListEdit={},t.checkLists=i.query(),t.getNumChecked=function(e){return angular.isUndefined(e)?0:_.size(_.where(e.check_list_items,{checked:!0}))},t.gotoCheckList=function(t){e.path("/lists/"+t.id)};var c=function(){var e=new i(t.checkListEdit),s=function(){t.checkLists.unshift(e),t.newCheckListTitle=""},c=function(){t.$root.$broadcast("alert",{message:"and we can't save "+t.newCheckListTitle+" right now",status:"danger",title:"Something's wrong"})};e.$save(s,c)};t.saveCheckList=function(){if(angular.isDefined(t.checkListEdit.id)){var e=new i(t.checkListEdit);e.$update()}else c()}}]),jotterDirectives.directive("jtrAlert",["$timeout",function(e){return{restrict:"E",scope:!0,templateUrl:"templates/alert.html",link:function(t){t.alertStatus="alert-info",t.message="",t.title="",t.visible=!1,t.$on("alert",function(i,s){t.alertStatus="alert-"+(s.status||"info"),t.message=s.message,t.title=s.title,t.visible=!0,e(function(){t.dismiss()},6500)}),t.dismiss=function(){t.visible=!1}}}}]),jotterDirectives.directive("jtrCheckListItems",[function(){return{restrict:"A",link:function(e){e.showCheckListItemEditForm=!1,e.cancelCheckListItemEdit=function(){e.checkListItemEdit={},e.showCheckListItemEditForm=!1,e.$root.$broadcast("checkList:refresh")},e.editCheckListItem=function(t){e.checkListItemEdit=t,e.showCheckListItemEditForm=!0,e.hideCheckListItemTools(t)},e.newCheckListItem=function(){e.editCheckListItem({})},e.hideCheckListItemTools=function(e){e.showTools=!1},e.showCheckListItemTools=function(e){e.showTools=!0},e.quickSaveCheckListItem=function(){e.checkListItemEdit={},e.checkListItemEdit.title=angular.copy(e.itemSearch),e.itemSearch="",e.saveCheckListItem()}}}}]),jotterDirectives.directive("jtrCheckListPermissions",["$timeout","CheckListPermissions",function(e,t){return{restrict:"A",link:function(i,s){i.showCheckListPermissionsEditForm=!1,i.checkListPermissions=[],i.checkListPermissionsSelect2Options={placeholder:"type to search",width:"resolve"};var c=function(){(!i.checkList.$resolved||1>i.users.length)&&e(function(){c()},100),i.checkListPermissions=t.query({id:i.checkList.id},function(t){var c;_.each(t,function(e){c=_.findWhere(i.users,{username:e.username}),angular.isDefined(c)&&(c.hasPermissions=!0),c.id===i.checkList.owner&&(c.locked=!0)}),e(function(){s.find("#checkListPermissionsEditUsers").select2(i.checkListPermissionsSelect2Options).on("change",function(e){i.toggleCheckListPermission(e.added||e.removed)})},50)})};i.closeCheckListPermissionsEdit=function(){i.showCheckListPermissionsEditForm=!1},i.editCheckListPermissions=function(){0===i.checkListPermissions.length&&c(),i.showCheckListPermissionsEditForm=!0},i.toggleCheckListPermission=function(e){t.toggle({id:i.checkList.id,user:e.id})}}}}]),jotterDirectives.directive("jtrHeader",["$location","Session",function(e,t){return{restrict:"E",scope:!0,templateUrl:"templates/header.html",link:function(i){t.getUser({onSuccess:function(t){i.user=t,t.isAuthenticated||e.path("/login")}})}}}]),jotterServices.factory("CheckList",["$resource",function(e){return e("/api/v1/check-lists/:id",{id:"@id"},{query:{method:"GET",params:{id:""},isArray:!0}})}]),jotterServices.factory("CheckListItem",["$resource",function(e){return e("/api/v1/check-list-items/:id",{id:"@id"},{update:{method:"PUT"}})}]),jotterServices.factory("CheckListPermissions",["$resource",function(e){return e("/api/v1/check-list-permissions/:id",{id:"@id"},{toggle:{method:"PUT"}})}]),jotterServices.factory("Session",["$resource",function(e){var t=function(){var e=!1,t=!1,i="";return{isAuthenticated:e,isSet:t,username:i,setFromResource:function(e){this.isAuthenticated=e.isAuthenticated,this.isSet=!0,this.username=e.username}}},i=t(),s=e("/api/v1/sessions",{},{create:{method:"POST"},"delete":{method:"DELETE"},get:{method:"GET"}});return{create:function(){var e=arguments[0]||{},t=arguments[1]||function(){},c=arguments[2]||function(){},n=function(e){i.setFromResource(e),t(e)},r=function(e){c(e)};s.create(e,n,r)},"delete":function(){var e=arguments[1]||function(){},t=arguments[2]||function(){},c=function(t){i.setFromResource(t),e(t)},n=function(e){t(e)};s.delete(c,n)},getUser:function(e){e=e||{},i.isSet?angular.isFunction(e.onSuccess)&&e.onSuccess(i):s.get({},function(t){i.setFromResource(t),angular.isFunction(e.onSuccess)&&e.onSuccess(i)})}}}]),jotterServices.factory("User",["$resource",function(e){return e("/api/v1/users/:id",{id:"@id"},{query:{method:"GET",params:{id:""},isArray:!0}})}]);